#!/usr/bin/env python
"""
    Start script for reduction application
"""
from __future__ import absolute_import, division, print_function
import sys
import os
import types

import logging
import logging.handlers

# Set log level
logging.getLogger().setLevel(logging.INFO)

# Formatter
ft = logging.Formatter("%(levelname)s:%(asctime)-15s %(message)s")
# Create a log file handler
fh = logging.handlers.TimedRotatingFileHandler(
    os.path.join(os.path.expanduser("~"), "refred_m.log"), when="midnight", backupCount=15
)
fh.setLevel(logging.INFO)
fh.setFormatter(ft)
logging.getLogger().addHandler(fh)


def no_abort_excepthook(exc_type, value, tback):
    # log the exception here
    logging.error("Abort-type of error %s:\n%s", value, tback)
    # then call the default handler
    sys.__excepthook__(exc_type, value, tback)


sys.excepthook = no_abort_excepthook

# Set Qt5Agg now so matplotlib doesn't complain later
import matplotlib

matplotlib.use("Qt5Agg")

# Import mantid according to the application configuration
# Do it here to enforce the correct version
from reflectivity_ui.interfaces.data_handling import ApplicationConfiguration

application_conf = ApplicationConfiguration()
if application_conf.mantid_path is not None:
    sys.path.insert(0, os.path.join(application_conf.mantid_path, "bin"))
    sys.path.insert(1, os.path.join(application_conf.mantid_path, "lib"))

import mantid
import reflectivity_ui

print("##################################################")
print("# QuickNXS %s " % reflectivity_ui.__version__)
print("#    with Mantid: %s " % mantid.__version__)
print("##################################################")

from PyQt5.QtWidgets import QApplication
from reflectivity_ui.interfaces.main_window import MainWindow


def main():
    app = QApplication(sys.argv)
    application = MainWindow()
    application.show()
    app.exec_()


if __name__ == "__main__":
    main()
