language: python
dist: trusty

matrix:
  include:
  - env: CONDA=3.6

before_install:
- |
  if [ "$TRAVIS_OS_NAME" = "linux" ]; then export CXX=g++-4.8 CC=gcc-4.8; fi
  if [ "$TRAVIS_OS_NAME" = "linux" ]; then OS=Linux-x86_64; else OS=MacOSX-x86_64; fi
   wget -O miniconda.sh https://repo.continuum.io/miniconda/Miniconda${CONDA:0:1}-latest-$OS.sh
   bash miniconda.sh -b -p $HOME/miniconda
   export PATH="$HOME/miniconda/bin:$PATH"
   conda init bash

install:
    # Setup conda activate/deactivate commands
  - conda init bash
  - source $(conda info --root)/etc/profile.d/conda.sh
  - conda info --root
   
    # Conda config - behavior and channel setup
  - conda config --set always_yes yes --set changeps1 no --set anaconda_upload no
  - conda config --add channels conda-forge --add channels mantid --add channels mantid/label/nightly

script:
    # TEST: create test environment and test build
  - conda install mamba
  - mamba create -q -n testenv python=2.7 mantid-framework=4.0 --file requirements.txt --file requirements_dev.txt
  - conda info --envs
  - conda activate testenv
  - python --version
  
  - pip install --upgrade codecov
  - cd test
  - wget http://198.74.56.37/ftp/external-data/MD5/214df921d4fa70ff5a33c4eb6f8284ad -O REF_M_24949
  - wget http://198.74.56.37/ftp/external-data/MD5/58d6698e1d6bf98e0315687cb980d333 -O REF_M_29160
  - cd ..

    # Test
  - xvfb-run --server-args="-screen 0 640x480x24" --auto-servernum python -m pytest test/ui --disable-pytest-warnings -vv -r w
  - cd test; coverage run data_handling_test.py

after_success:
  - codecov
